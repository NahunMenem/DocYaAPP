{% extends "base.html" %}
{% block title %}Registro de Médico | DocYa{% endblock %}

{% block head_scripts %}
<!-- Google Places API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnaoExuqJAcquC_joiPZA1lGDdhRHV4wY&libraries=places"></script>
{% endblock %}

{% block content %}
<div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-6">
    <!-- Logo -->
    <div class="flex flex-col items-center mb-6">
        <img src="{{ url_for('static', filename='images/logo1 (1).png') }}" alt="DocYa" class="h-20 mb-3">
        <h1 class="text-2xl font-bold text-dark">Registro</h1>
        <p class="text-gray-500 text-sm text-center">Complete sus datos para unirse a la red DocYa</p>
    </div>

    <!-- Mensajes -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-4 w-full">
          {% for category, message in messages %}
            <div class="p-2 rounded text-sm {{ 'bg-green-100 text-green-800' if category == 'success' else 'bg-red-100 text-red-800' }}">
              {{ message }}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Formulario -->
    <form method="POST" class="space-y-3">
        <!-- Nombre -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="user" class="w-5 h-5 text-gray-400"></i>
            <input type="text" name="nombre" placeholder="Nombre" class="ml-2 w-full outline-none" required>
        </div>
        <!-- Apellido -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="user" class="w-5 h-5 text-gray-400"></i>
            <input type="text" name="apellido" placeholder="Apellido" class="ml-2 w-full outline-none" required>
        </div>
        <!-- DNI -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="id-card" class="w-5 h-5 text-gray-400"></i>
            <input type="text" name="dni" placeholder="DNI" class="ml-2 w-full outline-none" required>
        </div>
        <!-- Matrícula -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="badge-check" class="w-5 h-5 text-gray-400"></i>
            <input type="text" name="matricula" placeholder="Matrícula" class="ml-2 w-full outline-none" required>
        </div>
        <!-- Profesión -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="stethoscope" class="w-5 h-5 text-gray-400"></i>
            <select name="profesion" class="ml-2 w-full outline-none bg-transparent" required>
                <option value="" disabled selected>Seleccione profesión</option>
                <option value="Medico">Médico</option>
                <option value="Enfermero">Enfermero</option>
            </select>
        </div>



        <!-- Dirección -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="map-pin" class="w-5 h-5 text-gray-400"></i>
            <input type="text" id="direccion" name="direccion" placeholder="Dirección" class="ml-2 w-full outline-none" autocomplete="off" required>
        </div>
        <!-- Campos ocultos -->
        <input type="hidden" name="latitud" id="latitud">
        <input type="hidden" name="longitud" id="longitud">
        <!-- Mapa -->
        <div id="map" class="mt-3 rounded-lg border" style="height: 250px;"></div>
        <!-- Teléfono -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="phone" class="w-5 h-5 text-gray-400"></i>
            <input type="text" name="telefono" placeholder="Teléfono" class="ml-2 w-full outline-none" required>
        </div>
        <!-- Email -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="mail" class="w-5 h-5 text-gray-400"></i>
            <input type="email" name="email" placeholder="Correo electrónico" class="ml-2 w-full outline-none" required>
        </div>
        <!-- CBU/Alias -->
        <div class="flex items-center border rounded-lg px-3 py-2">
            <i data-lucide="banknote" class="w-5 h-5 text-gray-400"></i>
            <input type="text" name="cbu_alias" placeholder="CBU / Alias" class="ml-2 w-full outline-none" required>
        </div>
        <!-- Botón -->
        <button type="submit" class="w-full bg-primary text-white py-2 rounded-lg hover:bg-blue-600 transition flex items-center justify-center gap-2">
            <i data-lucide="save"></i> Registrar
        </button>
    </form>
</div>
{% endblock %}

{% block body_scripts %}
<script>
let map, marker;
function initAutocomplete() {
    const input = document.getElementById("direccion");
    const autocomplete = new google.maps.places.Autocomplete(input, {
        componentRestrictions: { country: "ar" },
        fields: ["formatted_address", "geometry"]
    });

    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -34.6037, lng: -58.3816 },
        zoom: 13
    });

    marker = new google.maps.Marker({
        map: map,
        visible: false
    });

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(position => {
            const userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };
            map.setCenter(userLocation);
            map.setZoom(15);
            marker.setPosition(userLocation);
            marker.setVisible(true);
            document.getElementById("latitud").value = userLocation.lat;
            document.getElementById("longitud").value = userLocation.lng;
        });
    }

    autocomplete.addListener("place_changed", function () {
        const place = autocomplete.getPlace();
        if (!place.geometry) return;
        document.getElementById("latitud").value = place.geometry.location.lat();
        document.getElementById("longitud").value = place.geometry.location.lng();
        input.value = place.formatted_address;
        map.setCenter(place.geometry.location);
        map.setZoom(15);
        marker.setPosition(place.geometry.location);
        marker.setVisible(true);
    });
}
google.maps.event.addDomListener(window, "load", initAutocomplete);
</script>
{% endblock %}
